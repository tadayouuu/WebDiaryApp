@model IEnumerable<WebDiaryApp.Models.DiaryEntry>

<h1 class="mb-3">日記一覧</h1>

<a class="btn btn-success mb-3" asp-action="Create">新規作成</a>

<div class="row row-cols-1 g-3">

    @foreach (var item in Model.OrderByDescending(d => d.Date))
    {
        <div class="col">
            <div class="card shadow-sm diary-card" data-id="@item.Id" style="cursor:pointer;">

                <!-- 表示部分 -->
                <div class="card-body summary">
                    <h5 class="card-title text-truncate">@item.Title</h5>
                    <p class="card-text text-truncate">@item.Content</p>
                    <small class="text-muted">@item.Date?.ToString("yyyy-MM-dd HH:mm")</small>
                    <div class="badge bg-secondary mt-1">@item.Tag</div>
                </div>

                <!-- 編集フォーム（初期は非表示） -->
                <div class="card-body edit-form d-none">
                    <form asp-action="Edit" method="post">
                        <input type="hidden" name="Id" value="@item.Id" />
                        <input class="form-control mb-2" name="Title" value="@item.Title" placeholder="タイトル" />
                        <textarea class="form-control mb-2" name="Content" rows="4">@item.Content</textarea>
                        <input class="form-control mb-2" name="Tag" value="@item.Tag" placeholder="タグ" />
                        <button type="submit" class="btn btn-primary btn-sm">更新</button>
                    </form>
                </div>

            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.diary-card').click(function (e) {
                // クリック対象がフォーム内のボタンや入力なら無視
                if ($(e.target).closest('form').length) return;

                // summary と edit-form を切り替え
                var $card = $(this);
                $card.find('.summary').toggleClass('d-none');
                $card.find('.edit-form').toggleClass('d-none');
            });
        });
    </script>
}
